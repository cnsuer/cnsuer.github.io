<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta property="og:site_name" content="Restver's Blog"/><link rel="canonical" href="https://cnsuer.github.io/articles/modulemap"/><meta name="twitter:url" content="https://cnsuer.github.io/articles/modulemap"/><meta property="og:url" content="https://cnsuer.github.io/articles/modulemap"/><title>åŠ¨æ€åº“ä¸­ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨ | Restver's Blog</title><meta name="twitter:title" content="åŠ¨æ€åº“ä¸­ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨ | Restver's Blog"/><meta property="og:title" content="åŠ¨æ€åº“ä¸­ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨ | Restver's Blog"/><meta name="description" content="Programming & Life"/><meta name="twitter:description" content="Programming & Life"/><meta property="og:description" content="Programming & Life"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@Hanley_Lei"/><meta name="twitter:creator" content="@Hanley_Lei"/><meta name="referrer" content="no-referrer"/><link rel="stylesheet" href="/css/styles.css" type="text/css"/><link rel="stylesheet" href="/css/code.css" type="text/css"/><link rel="stylesheet" href="/css/toc.css" type="text/css"/><link rel="stylesheet" href="/css/font.css" type="text/css"/><link rel="stylesheet" href="/css/search.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/img/icon_site.JPG" type="image/jpeg"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Restver's Blog"/><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/css/heti.min.css"/><meta name="theme-color" content="#C62F1C"/></head><body class="item-page"><header><div class="wrapper"><div class="logo"><a href="/"><img src="/img/icon_site.JPG"/></a></div><div><div class="headerIcons"><a class="icon headIconTwitter" href="https://www.twitter.com/" target="_blank" rel="noreferrer"></a><a class="icon headIconEmail" href="mailto:restver@gmail.com" target="_blank" rel="noreferrer"></a><a class="icon headIconGithub" href="https://github.com/restver/" target="_blank" rel="noreferrer"></a><a class="icon headIconZhihu" href="https://www.zhihu.com/" target="_blank" rel="noreferrer"></a><a class="icon headIconRss" href="/feed.rss" target="_blank" rel="noreferrer"></a></div></div><nav><ul><li><a href="/">æœ€è¿‘æ›´æ–°</a></li><li><a class="selected" href="/articles">å…¨éƒ¨æ–‡ç« </a></li><li><a href="/about">å…³äº</a></li><li><a href="/search">æœç´¢</a></li></ul><div class="weixinHeadQcode" onclick="$('.weixinHeadQcode').css('display','none');"></div></nav></div></header><div class="container"><div class="wrapper"><div class="viewContainer"><div class="centerContent"><div class="post-actions"><div class="actionButton"><div class="actionButton twitter" onclick="window.open('https://twitter.com/intent/tweet?text=åŠ¨æ€åº“ä¸­ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨&url=https://cnsuer.github.io/articles/modulemap&via=Hanley_Lei','target','');"></div></div><div class="actionButton"><div class="actionButton comment" onclick="$('html,body').animate({scrollTop: $('#gitalk-container').offset().top }, {duration: 500,easing:'swing'})"></div></div></div><article><div class="post-title"><h1>åŠ¨æ€åº“ä¸­ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨</h1></div><div><ul class="tag-list"><li class="tag variant-0"><a href="/tags/modulemap">â¦¿modulemap</a></li><li class="tag variant-3"><a href="/tags/swift">â¦¿swift</a></li><li class="tag variant-1"><a href="/tags/oc">â¦¿oc</a></li><li class="tagdate"></li><li class="reading-time">ğŸ‘“ 2 min</li></ul><div class="content"><h1>åŠ¨æ€åº“ä¸­ä½¿ç”¨modulemapä½¿OCä¸Swiftäº’ç›¸è°ƒç”¨</h1><pre><code># åŠ¨æ€åº“ä¸­OCå¦‚ä½•ä¸Swiftäº’ç›¸è°ƒç”¨
åœ¨RFrameworkä½¿ç”¨è¿‡ç¨‹ä¸­,é‡åˆ°äº†ä¸€ä¸ªéš¾ä»¥å¤ç°çš„é—®é¢˜,å†æ‰€ä»¥éœ€è¦å¯¹SDKæ·»åŠ Logè¿›è¡Œç›‘æ§,ç»è¿‡è°ƒç ”,å†³å®šå¼•å…¥`<span class="type">CocoaLumberjack</span>`è¿™ä¸ªæ—¥å¿—åº“,ä½†å› ä¸ºSDKæœ¬èº«æœ‰ä¸€äº›Swiftçš„ä»£ç ,ç°åœ¨åŠ å…¥è¿™ä¸ªæ—¥å¿—åº“å,éœ€è¦Swiftä¸­çš„ä»£ç è°ƒç”¨è¿™ä¸ªæ—¥å¿—åº“äº†,æ‰€ä»¥

### <span class="number">1</span>. **<span class="type">ObjC</span> è°ƒç”¨ <span class="type">Swift</span>**

åœ¨Frameworkä¸­å®ç° <span class="type">ObjC</span> è°ƒç”¨ <span class="type">Swift</span>,å’Œå¹³æ—¶åœ¨é¡¹ç›®ä¸­é‚£æ ·,è¿‡è®¾ç½®`<span class="type">Swift Compiler</span> -&gt; <span class="type">Objective</span>-<span class="type">C Generated Interface Header Name</span>`å°±å¯ä»¥äº†
- åœ¨ <span class="type">Build Setting</span> ä¸­,æœç´¢SWIFT_OBJC_INTERFACE_HEADER_NAME,é…ç½®æ­£ç¡®çš„åå­—,æ¯”å¦‚é»˜è®¤çš„`$(<span class="type">SWIFT_MODULE_NAME</span>)-<span class="type">Swift</span>.<span class="property">h</span>`
- ç„¶ååœ¨ <span class="type">ObjC</span> ä¸­å¼•å…¥è¯¥æ¨¡å—çš„ <span class="type">Swift</span> å¤´æ–‡ä»¶,ç„¶åä½¿ç”¨#import &lt;<span class="type">XXX</span>/<span class="type">XXX</span>-<span class="type">Swift</span>.<span class="property">h</span>&gt;å€’å…¥ç”Ÿæˆçš„å¤´æ–‡ä»¶
- è‹¥åœ¨ <span class="type">ObjCçš„</span> .<span class="dotAccess">h</span> ä¸­å¼•å…¥ï¼Œåˆ™å¯ä»¥é€šè¿‡å‘å‰å£°æ˜çš„æ–¹å¼ï¼Œ<span class="keyword">@class</span> <span class="type">XXX</span>

```<span class="type">ObjC</span>
<span class="comment">// RLog.m</span>
#import &lt;<span class="type">RFramework</span>/<span class="type">RFramework</span>-<span class="type">Swift</span>.<span class="property">h</span>&gt;

-(void)log:(<span class="type">NSString</span> *)<span class="call">message</span> {
  <span class="type">DDDebug</span>(message);
}

-(void)<span class="call">useSwiftTest</span> {
    <span class="type">RPreviewController</span> *preview = [[<span class="type">RPreviewController</span> alloc] <span class="keyword">init</span>];
    [preview show];
}
</code></pre><h3>2. <strong>Swift è°ƒç”¨ ObjC</strong></h3><p>ä½†æ˜¯åœ¨Frameworkä¸­å®ç° Swift è°ƒç”¨ ObjCï¼Œé€šè¿‡è®¾ç½® Bridging-Header çš„æ–¹å¼æ˜¯æ— æ³•è§£å†³çš„ã€‚å¦‚æœå°è¯•åœ¨<code>Swift Compiler -&gt; Objective-C Bridging Header</code>å¡«å…¥OCçš„å¤´æ–‡ä»¶,ç„¶åç¼–è¯‘,æœ€ç»ˆå°†ä¼šæŠ¥é”™: <code>Using bridging headers with framework targets is unsupported</code></p><p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>modulemap</code> çš„æ–¹å¼è®¿é—®,åˆ›å»ºä¸€ä¸ª<code>RFramework.modulemap</code>æ–‡ä»¶</p><pre><code><span class="comment">/* RtFramework.modulemap */</span>
framework module <span class="type">RFramework</span> {
    umbrella <span class="string">"Headers"</span>
    export *
}
</code></pre><p>ç„¶ååœ¨åœ¨ <code>buildSettings â†’ packaging â†’ Module Map File</code> å†™å…¥è¿™ä¸ª <code>modulemap</code>æ–‡ä»¶çš„è·¯å¾„,ç„¶åæŠŠæƒ³è¦åœ¨Swiftä¸­ä½¿ç”¨çš„OCæ–‡ä»¶,æ¯”å¦‚<code>Pikachu.h</code>æ”¾åœ¨<code>Build Phases â†’ Hearders â†’ Public</code> ä¸­</p><pre><code><span class="comment">// RPreviewController.swift</span>
<span class="keyword">@objcMembers public class</span> RPreviewController: <span class="type">UIViewController</span> {
    ...

    <span class="keyword">func</span> show() {

      ....

      webView.<span class="call">loadRequest</span>(request)

      <span class="type">RLog</span>.<span class="call">log</span>(<span class="string">"RPreviewController.show"</span>)
    }

}
</code></pre><p>æ­¤æ—¶å°±å¯ä»¥åœ¨åŠ¨æ€åº“å†…éƒ¨,ä½¿ç”¨Swiftè°ƒç”¨OCäº†.</p><p>é‚£è¿™ä¸ª <code>modulemap</code> æ˜¯ä¸ªå•¥æ„æ€å‘¢,å®ƒæ˜¯ç”¨æ¥æè¿°å¤´æ–‡ä»¶ä¸moduleä¹‹é—´æ˜ å°„çš„å…³ç³»,æ¯”å¦‚å‰è¾¹å†™çš„é‚£ä¸ªæ–‡ä»¶: <code>framework module ä»£è¡¨è¿™ä¸ªæ˜¯ä¸€ä¸ªFrameworkçš„module,</code> Frameworkçš„åç§°å«åš<code>RFramework</code></p><p><code>umbrella "Headers"</code>,è¡¨ç¤ºè¯¥æ¨¡å—åŒ…å« <code>"Headers"</code>ç›®å½•ä¸‹çš„æ‰€æœ‰å¤´æ–‡ä»¶.å…¶å®ä»åå­—çœ‹å°±ä¹Ÿèƒ½å¤§æ¦‚ç†è§£,ä¼çŠ¶å¤´æ–‡ä»¶,ä¼ä¸‹è¾¹çš„æ‰€æœ‰ä¸œè¥¿(ä¼å…µå•Šä»€ä¹ˆçš„â€¦),éƒ½å±äºä¼çš„ä¸€éƒ¨åˆ†</p><p>OK,é‚£ä¹ˆHeadersæ–‡ä»¶å¤¹æ˜¯å“ªé‡Œæ¥çš„å‘¢?å½“frameworkç¼–è¯‘å®Œå,ç¼–è¯‘äº§ç‰©ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªHeadersæ–‡ä»¶å¤¹,å¹¶ä¸”æŠŠæ‰€æœ‰ <code>Public</code> çš„å¤´æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa07bbea-3759-4d64-ac98-67e7ec9ab05b/Untitled.png"/></p><p>åœ¨å¤–éƒ¨é¡¹ç›®ä¸­ä½¿ç”¨:</p><pre><code><span class="comment">// ViewController.m</span>
#import &lt;<span class="type">RFramework</span>/<span class="type">RFramework</span>.<span class="property">h</span>&gt;
<span class="comment">//æˆ–è€…ä½¿ç”¨moduleè¯­æ³• `@import RFramework;`</span>

- (void)<span class="call">viewDidLoad</span> {
    [<span class="keyword">super</span> viewDidLoad];
    
    <span class="type">RPreviewController</span> *m = [[<span class="type">RPreviewController</span> alloc] <span class="keyword">init</span>];
    <span class="type">RLog</span> *l = [[<span class="type">RLog</span> alloc] <span class="keyword">init</span>];
}
</code></pre><p>å½“ç„¶åœ¨çœ‹åˆ«äººç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™,ä¼šå‘ç°è¿˜æœ‰å¦å¤–ä¸€ç§ç”¨æ³•:</p><pre><code>framework module <span class="type">RFramework</span> {
    umbrella header <span class="string">"RFramework.h"</span>
    export *
}
</code></pre><p>è¿™ç§å†™æ³•çš„æ„æ€æ˜¯,åªæœ‰åœ¨<code>"RFramework.h"</code> ä¸­å¼•ç”¨çš„å¤´æ–‡ä»¶,æ‰èƒ½ä½œä¸ºè¯¥æ¨¡å—çš„ä¸€éƒ¨åˆ†ç»™å¤–éƒ¨ä½¿ç”¨,æ¯”å¦‚æˆ‘ä»¬åœ¨ <code>RFramework.h</code> ä¸­å¯¼å…¥ä¸‹è¾¹çš„æ–‡ä»¶</p><pre><code><span class="comment">// RFramework.h</span>
#import <span class="string">"RPreviewController.h"</span>
</code></pre><p>æ­¤æ—¶,ä½ ä¼šå‘ç° <code>RPreviewController</code> å¯ä»¥æ­£å¸¸ä½¿ç”¨, <code>RLog</code>æŠ¥é”™äº†,ä½¿ç”¨æœªå£°æ˜çš„æ–‡ä»¶,å³ä½¿ä½ å¼ºè¡Œå¯¼å…¥è¿™ä¸ªæ–‡ä»¶ <code>#import &lt;RFramework/RLog.h&gt;</code> ä¹Ÿè¿˜æ˜¯æŠ¥é”™</p><pre><code>#import &lt;<span class="type">RFramework</span>/<span class="type">RFramework</span>.<span class="property">h</span>&gt;

- (void)<span class="call">viewDidLoad</span> {
    [<span class="keyword">super</span> viewDidLoad];
    
    <span class="type">RPreviewController</span> *m = [[<span class="type">RPreviewController</span> alloc] <span class="keyword">init</span>];
    <span class="type">RLog</span> *r = [[<span class="type">RLog</span> alloc] <span class="keyword">init</span>]; <span class="comment">// Use of undeclared identifier 'RLog'</span>
}
</code></pre><p>å­moduleçš„è¯­æ³•,æŠŠå¼€å§‹çš„ä¾‹å­çš„modulemapæ–‡ä»¶åšäº›ä¿®æ”¹,åœ¨moduleä¸­å†å£°æ˜ä¸¤module: <code>Preview</code> å’Œ <code>Log</code></p><pre><code>framework module <span class="type">RFramework</span> {
    module <span class="type">Preview</span> {
        header <span class="string">"RPreviewController.h"</span>
    }
    module <span class="type">Log</span> {
        header <span class="string">"RLog.h"</span>
    }
}
</code></pre><p>ä½¿ç”¨çš„æ—¶å€™åªå¯¼å…¥ <code>#import &lt;RFramework/RPreviewController.h&gt;</code> æˆ–è€…ä½¿ç”¨moduleè¯­æ³• <code>@import RFramework.Preview;</code>å°±å¯ä»¥äº†</p><pre><code>- (void)<span class="call">viewDidLoad</span> {
    [<span class="keyword">super</span> viewDidLoad];

    <span class="type">RPreviewController</span> *p = [[<span class="type">RPreviewController</span> alloc] <span class="keyword">init</span>];
	
}
</code></pre><p><code>export *</code> é¦–å…ˆè¯´ <code>export</code>,ä¹Ÿå¯ä»¥å«åšre_export</p><p>ä½¿ç”¨ä¸Šè¾¹çš„é‚£ä¸ªmodulemapæ–‡ä»¶,ç„¶ååªå¯¼å…¥<code>@import RFramework.Preview;</code>,è¿™æ—¶ç¼–è¯‘å°±ä¼šæŠ¥é”™,è¦æƒ³ä½¿ç”¨RLogçš„è¯,éœ€è¦å¯¼å…¥æ¨¡å— <code>Log</code></p><pre><code>- (void)<span class="call">viewDidLoad</span> {
    [<span class="keyword">super</span> viewDidLoad];

    <span class="type">RPreviewController</span> *p = [[<span class="type">RPreviewController</span> alloc] <span class="keyword">init</span>];
		<span class="comment">// Declaration of 'RLog' must be imported from module 
    //'RFramework.Log' before it is required</span>
    <span class="type">RLog</span> *l = [[<span class="type">RLog</span> alloc] <span class="keyword">init</span>];
}
</code></pre><p>å½“ç„¶,ç›´æ¥å¯¼å…¥<code>Log</code>æ¨¡å—å°±ä¸ä¼šæŠ¥é”™äº†,ä½†æ˜¯å¦‚æœæˆ‘æ—¢ä¸æƒ³å¯¼å…¥,è¿˜æƒ³æ­£å¸¸ä½¿ç”¨è¯¥æ€ä¹ˆåŠå‘¢?</p><pre><code>module <span class="type">Preview</span> {
    header <span class="string">"RPreviewController.h"</span>
    export <span class="type">Log</span>
}
</code></pre><p>å¯¹modulemapæ–‡ä»¶ç¨åšä¿®æ”¹,æŠŠ<code>Log</code> åœ¨ <code>Preview</code> çš„æ¨¡å—ä¸­é‡æ–°å¯¼å‡ºå»,ä½¿ç”¨å°±ä¸ä¼šæŠ¥é”™,æ‰€ä»¥ ä¸Šè¾¹çš„ <code>export *</code> çš„æ„æ€å°±å¾ˆæ˜æ˜¾äº†,å¯¼å‡ºå½“å‰ <code>å¤´æ–‡ä»¶/å¤´æ–‡ä»¶é›†åˆ</code> çš„æ‰€æœ‰çš„ç¬¦å·</p><p>å½“ç„¶,subModuleå…¶å®åœ¨swiftä¸­,åªæœ‰è±¡å¾æ„ä¹‰äº†,å°½ç®¡åªå€’å…¥</p><p>å‚è€ƒ1: <a href="https://zhuanlan.zhihu.com/p/349967113" target="_blank">äº¬ä¸œApp Swift æ··ç¼–åŠç»„ä»¶åŒ–è½åœ° - çŸ¥ä¹ (zhihu.com)</a></p><p>å‚è€ƒ2: <a href="https://juejin.cn/post/6956467380604436494" target="_blank">Swiftä¸Objective-Cäº’ç›¸è°ƒç”¨(æ€»ç»“) - æ˜é‡‘ (juejin.cn)</a></p><pre><code>
</code></pre></div><div class="license"><p>æœ¬åšå®¢æ–‡ç« é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC 4.0 åè®®</a>ï¼Œè½¬è½½éœ€æ³¨æ˜å‡ºå¤„å’Œä½œè€…ã€‚</p></div></div></article><div class="item-navigator"><table><tr><td></td><td class="next-item"><a href="/articles/oc-webview-promise">OC ä»£ç  webview æ‰§è¡Œ JS,å¦‚ä½•æœ‰æ•ˆçš„æ¶ˆé™¤å›è°ƒåœ°ç‹±</a></td></tr></table></div></div><div class="side-nav"><div class="sidebar"></div></div>    <script src="/js/toc.js"></script></div></div><footer><p>Copyright &copy; Restver 2023 <a href="http://beian.miit.gov.cn">äº¬ICPå¤‡20000113å·</a></p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a></p><ul><li><a href="https://twitter.com/" target="_blank"><img class="twitter" src="/img/twitter.svg"/></a></li><li><a href="https://github.com/restver/" target="_blank"><img src="/img/github.svg"/></a></li><li><a href="https://www.zhihu.com/" target="_blank"><img src="/img/zhihu.svg"/></a></li><li><a href="/feed.rss"><img src="/img/rss.svg"/></a></li></ul></footer></div></body></html>